<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yuantu.data.hotel.HotelMapper">
    <!--查询-->
    <select id="selectHotelInfo" resultMap="Hotel" parameterType="int">
        select hotel.hotelname,hotel.address,hotel.businessdistrict,hotel.Introduction,hotel.facilities,hotel.Star,hotel.score from hotel
        <where>
            hotel.id =#{hotelId}
        </where>
    </select>

    <!--模糊查询-->
    <select id="selectLikeQuery" resultMap="Hotel">
        select address,businessdistrict, Introduction, facilities, Star, hotelname, score from hotel
        where  CONCAT(Star,score,hotelname,businessdistrict)
        <if test="condition !=null">
            like CONCAT('%',#{condition},'%')
        </if>
    </select>


    <!--更新酒店信息-->
  <update id="updateHotelInfo" parameterType="com.yuantu.po.Hotel">
        update hotel
        <set>
            <if test="hotel.hotelName !=null and hotel.hotelName !=''">hotelName=#{hotel.hotelName},</if>
            <if test="hotel.address !=null and hotel.address !=''">address=#{hotel.address},</if>
            <if test="hotel.businessDistrict !=null and hotel.businessDistrict !=''">businessDistrict=#{hotel.businessDistrict},</if>
            <if test="hotel.introduction !=null and hotel.introduction !=''">introduction=#{hotel.introduction},</if>
            <if test="hotel.facilities !=null and hotel.facilities !=''">facilities=#{hotel.facilities},</if>
            <if test="hotel.star !=null and hotel.star !=''">star=#{hotel.star},</if>
            <if test="hotel.score !=null and hotel.score !=''">score=#{hotel.score}</if>
        </set>
        <where>
            id =#{hotelId}
        </where>
    </update>

    <!--通过酒店价格从低到高，星级和评分排序-->
    <select id="selectHotelSort" resultType="Hotel" parameterType="string">
    select hotel.hotelname,hotel.address,hotel.businessdistrict,hotel.Introduction,hotel.facilities,hotel.Star,hotel.score,avg(room.price) as averagePrice
    from hotel
    left join
    room on hotel.id=room.hotel_id GROUP BY hotel.id
    <trim prefix="ORDER BY" suffix="ASC">

       <if test="condition !=null and condition =='星级'">
            Star
        </if>

        <if test="condition !=null and condition =='评分'">
            score
        </if>

        <if test="condition !=null and condition =='价格'">
            averagePrice
        </if>
    </trim>
    </select>

    <resultMap id="Hotel" type="com.yuantu.po.Hotel">
        <result column="id" property="id"></result>
        <result column="hotelname" property="hotelName"></result>
        <result column="address" property="address"></result>
        <result column="businessdistrict" property="businessDistrict"></result>
        <result column="introduction" property="introduction"></result>
        <result column="facilities" property="facilities"></result>
        <result column="Star" property="star"></result>
        <result column="score" property="score"></result>
    </resultMap>


</mapper>